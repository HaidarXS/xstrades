var FLIPBOOK=FLIPBOOK||{};FLIPBOOK.PdfService=function(e,t,n){var i=this;this.pdfDocument=e,this.pdfInfo=e._pdfInfo,this.numPages=this.pdfInfo.numPages,this.webgl="webgl"==n.viewMode,this.options=n,this.main=n.main,this.model=t,this.pages=[],this.thumbs=[],this.canvasBuffer=[],this.viewports=[],this.textContents=[],this.pdfPages=[],this.bookPagesRendered=[],this.pdfAnnotations=[],this.eventBus=new EventBus,window._dbg=0,this.getCanvas=function(){var e,t;for(e=0;e<this.canvasBuffer.length;e++){if((t=this.canvasBuffer[e]).available){t.available=!1,t.double=!1;break}t=null}return t||((t=document.createElement("canvas")).available=!1,t.index=this.canvasBuffer.length,this.canvasBuffer.push(t)),t.rendering=!0,t},this.isRendering=function(e,t){var n=!1;return this.canvasBuffer.forEach(function(i){i.size==t&&i.pdfPageIndex==e&&i.rendering&&(n=!0)}),n},this.isRendered=function(e,t){var n=!1;return this.canvasBuffer.forEach(function(i){i.size==t&&i.pdfPageIndex==e&&i.rendered&&(n=!0)}),n},this.setRightIndex=function(e){var t=this,n=[];this.options.isMobile,this.canvasBuffer.forEach(function(i){_dbg&&console.log("rendering : "+i.rendering+" pageIndex : "+i.pageIndex+" pdfPageIndex : "+i.pdfPageIndex),(!i.rendering&&7<e-i.pageIndex||e-i.pageIndex<-6)&&-1<i.pageIndex&&(-1<i.pdfPageIndex&&(delete t.pages[i.pdfPageIndex].canvas[i.size],t.pages[i.pdfPageIndex].cleanup()),n.push({index:i.pageIndex,size:i.size}),i.double&&n.push({index:i.pageIndex-1,size:i.size}),i.getContext("2d").clearRect(0,0,i.width,i.height),i.width=i.height=0,_dbg&&console.log("----- released canvas "+i.index+" containing PDF page "+i.pdfPageIndex+" canvas rendering : "+i.rendering),i.pageIndex=-100,i.available=!0,i.rendered=!1)}),0<n.length&&this.model.trigger("pageUnloaded",{unloadedPages:n})},window.s=function(){var e=document.getElementById("debug")||document.createElement("div");document.body.appendChild(e),i.canvasBuffer.forEach(function(t){var n=document.createElement("span");n.style.margin="2px",n.style.background="#ccc",n.style.display="inline-block",e.appendChild(n);var i=t.toDataURL(),a=new Image;a.src=i,a.style.border=t.available?"1px solid #0F0":"1px solid #F00",n.appendChild(a),a.height=100;var r=document.createElement("span");r.style.display="block",n.appendChild(r),r.innerText=t.pageIndex+";"+t.size+";"+t.rendering})},this.loadThumbs=function(e,t){var n=this;this.thumbLoading=this.thumbLoading||0,this.thumbLoading>=this.pdfInfo.numPages?t.call(n):this.loadThumb(this.thumbLoading,function(i){n.options.thumbLoaded(i),n.thumbLoading++,n.loadThumbs(e,t)})},this.loadThumb=function(e,t){var n=this;this.getViewport(e,function(){var i=n.pages[e],a=100/i.getViewport({scale:1}).height,r=i.getViewport({scale:a}),s=document.createElement("canvas");s.index=e;var o=s.getContext("2d");s.height=r.height,s.width=r.width,i.cleanupAfterRender=!0,i.render({canvasContext:o,viewport:r}).then(function(){i.cleanup(),t&&t.call(n,s)})})},this.init=function(e){i.getViewport(0,function(t){i.r1=t.width/t.height,1==i.pdfInfo.numPages?(i.double=!1,i.model.trigger("pdfinit")):i.getViewport(1,function(t){i.r2=t.width/t.height,i.double=1.5<i.r2/i.r1,i.backCover=e||!0,i.model.trigger("pdfinit")})})},this.loadOutline=function(e){var t=this;this.pdfDocument.getOutline().then(function(n){t.outline=n,t.outlineLoaded=!0,e.call(t,n)})},this.startLoadingText=function(){this.loadingText=!0},this.stopLoadingText=function(){this.loadingText=!1},this.getViewport=function(t,n){t>=i.pdfInfo.numPages||(i.pages[t]?(i.viewports[t]=i.pages[t].getViewport({scale:1}),n.call(i,i.viewports[t])):e.getPage(t+1).then(function(e){i.pages[e.pageIndex]=e,i.getViewport(e.pageIndex,n)}))},this.getAllViewports=function(e){},this.getText=function(e,t){var n=this;this.getViewport(e,function(i){var a=n.pages[e];n.getTextContent(a,function(){t.call(n,a)})})},this.getTextAllPages=function(e){var t=this;this.loadingTextFromPage=this.loadingTextFromPage||0,this.getText(this.loadingTextFromPage,function(){t.loadingTextFromPage==t.numPages-1?e&&e.call(t):(t.loadingTextFromPage++,t.getTextAllPages(e))})},this.findInPage=function(e,t,n){var i=this;this.findInPageCallbacks=this.findInPageCallbacks||[],this.findInPageCallbacks[t]=n,this.searchingString=e,this.pages[t]&&this.pages[t].textContent?i.findInPageTextContentAvailable(this.pages[t],t):this.getText(t,function(e){i.findInPageTextContentAvailable(e,t)})},this.findInPageTextContentAvailable=function(e,t){for(var n=e.textContent.items,i=0,a=0;a<n.length;a++){var r=n[a].str;r.includes(this.searchingString)&&i++,r.toUpperCase().includes(this.searchingString.toUpperCase())&&i++}var s=this.findInPageCallbacks[t];s&&s.call(this,i,e.htmlContent),this.findInPageCallbacks[t]=null},this.getThumb=function(e,t,n){this.getViewport(e,function(a){var r=i.pages[e];if(r.thumb)n.call(i,r.thumb);else{var s=t/i.viewports[e].height,o=(a=r.getViewport({scale:s}),document.createElement("canvas")),d=(r.thumb=o).getContext("2d");o.height=a.height,o.width=a.width;var l={canvasContext:d,viewport:a};r.cleanupAfterRender=!0,r.render(l).then(function(){r.cleanup(),n.call(i,r.thumb)})}})},this.getPage=function(t,n){var i=this;(i.double?Math.round(t/2)+1:t+1)>this.pdfInfo.numPages||e.getPage(t).then(function(e){i.renderPage(e,n)})},this.renderPage=function(e,t,n){var i=this;if(e.canvas=e.canvas||{},e.canvas[t]&&e.canvas[t].rendered)return n&&n.call(i,e),void(n=null);e.rendering&&setTimeout(function(){i.renderPage(e,t,n)},300),e.rendering=!0;var a=i.getCanvas();a.size=t,a.pdfPageIndex=e.pageIndex,this.getTextContent(e,function(){var r=e.getViewport({scale:1}),s=r.width<=r.height,o=s||!i.webgl?t/r.height:t/r.width,d=e.getViewport({scale:o});a.width=d.width,a.height=d.height,i.webgl&&(s?(a.height=t,a.width=d.width>t?d.width:t,a.scaleX=d.width/t,a.scaleY=1):(a.width=t,a.height=d.height>t?d.height:t,a.scaleY=d.height/t,a.scaleX=1));var l=a.getContext("2d");l.fillStyle="#FFFFFF",l.fillStyle="#000000";var h={canvasContext:l,viewport:d};e.scale=o,e.canvas[t]=a,e.canvas[t].ratio=d.width/d.height,e.cleanupAfterRender=!0,_dbg&&console.log("     ........ rendering pdf page "+e.pageIndex+" "+t+" to canvas "+a.index),e.render(h).promise.then(function(){h=null,_dbg&&console.log("     ********** pdf page "+e.pageIndex+" "+t+" rendered to canvas "+a.index),n&&n.call(i,e),e.rendering=!1,n=null})})},this.renderBookPage=function(e,t,n){var i="doubleWithCover"==this.options.pageMode?Math.round(e/2):e;this.renderPageFromPdf(i,t,n)},this.renderPageFromPdf=function(e,t,n){var i=this;if(e>=this.pdfInfo.numPages&&n.call(i),this.pages[e]){var a=e,r=this.pages[e],s=r.getViewport({scale:1});s.width,s.height,s.height,this.isRendering(a,t)?setTimeout(function(){i.renderPageFromPdf(e,t,n)},300):this.isRendered(a,t)?this.onPdfPageRendered(i.pages[a],t,n):(_dbg&&console.log("render pdf page ",e,t),this.renderPage(r,t,function(e){i.onPdfPageRendered(e,t,n)}))}else this.getViewport(e,function(a){i.renderPageFromPdf(e,t,n)})},this.onBookPageRendered=function(e,t,n,i){this.bookPagesRendered[n]=this.bookPagesRendered[n]||{},this.bookPagesRendered[n][i]=!0,this.model.trigger("pageLoaded",{index:n,size:i,canvas:t}),_dbg&&console.log(" --> book page rendered  "+(n+1)+" "+i+" on canvas "+t.index+t.rendering)},this.getBookPage=function(e,t){var n=null;return this.canvasBuffer.forEach(function(i){i.pageIndex==e&&i.size==t&&(n=i)}),n},this.onPdfPageRendered=function(e,t,i){if(e.canvas&&e.canvas[t]){var a=e.canvas[t],r=e.htmlContent,s=e.pageIndex;if(a.pdfPageIndex=s,void 0!==a){if("doubleWithCover"==n.pageMode){if(0==s)f(r,s),a.pageIndex=0,a.rendering=!1,a.rendered=!0,this.onBookPageRendered(e,a,0,t);else if(s==n.pages.length/2)f(r,n.numPages-1),a.pageIndex=n.numPages-1,a.rendering=!1,a.rendered=!0,this.onBookPageRendered(e,a,n.numPages-1,t);else if(r.style.transformOrigin="0 0",this.webgl){a.double=!0,a.scaleX=a.width/2/t,a.scaleY=a.scaleY;var o=r.cloneNode(!0);f(r,2*s-1),f(o,2*s),a.pageIndex=2*s,a.rendering=!1,a.rendered=!0,this.onBookPageRendered(e,a,2*s,t),this.onBookPageRendered(e,a,2*s-1,t)}else{o=r.cloneNode(!0),f(r,2*s-1),f(o,2*s);var d=this.options.rightToLeft?2*s-1:2*s,l=this.options.rightToLeft?2*s:2*s-1,h=this.getBookPage(l,t);if(!h){(h=this.getCanvas()).size=t;var c=h.getContext("2d");h.width=a.width/2,h.height=a.height,c.fillStyle="#FFFFFF",h.pageIndex=l,h.pdfPageIndex=s,c.drawImage(a,0,0),h.rendering=!1,h.rendered=!0}this.onBookPageRendered(e,h,l,t);var g=this.getBookPage(d,t);if(!g){(g=this.getCanvas()).size=t;var u=g.getContext("2d");g.width=a.width/2,g.height=a.height,u.fillStyle="#FFFFFF",g.pageIndex=d,g.pdfPageIndex=s,u.drawImage(a,a.width/2,0,a.width/2,a.height,0,0,a.width/2,a.height),g.rendering=!1,g.rendered=!0}this.onBookPageRendered(e,g,d,t),a.size=200,a.pageIndex=l,a.rendering=!1,a.rendered=!0}}else f(r,s),a.pageIndex=s,a.size=t,a.rendering=!1,a.rendered=!0,this.onBookPageRendered(e,a,s,t);i&&i.call(this,{canvas:a,size:t,pdfPageIndex:s}),i=null}}function f(e,t){var i=n.pages[t];i.htmlContentInitialized||(i.htmlContent&&jQuery(e).append(jQuery(i.htmlContent)),i.htmlContentInitialized=!0,i.htmlContent=e)}},this.getTextContent=function(t,n){t.htmlContent?n(t):t.getTextContent().then(function(a){t.textContent=a;var r=document.createElement("div");if(r.classList.add("flipbook-page-htmlContent"),i.options.textLayer){var s=document.createElement("div");s.className="flipbook-textLayer";var o=1e3/t.getViewport({scale:1}).height;s.style.width=String(1e3*t.getViewport({scale:1}).width/t.getViewport({scale:1}).height)+"px",s.style.height="1000px";var d=new TextLayerBuilder({eventBus:i.eventBus,textLayerDiv:s,pageIndex:t.pageIndex,viewport:t.getViewport({scale:o})});d.setTextContent(a),d.render(TEXT_LAYER_RENDER_DELAY),r.appendChild(s)}var l=new PDFLinkService({eventBus:i.eventBus});l.setViewer(i.main),l.setDocument(e),l.externalLinkTarget=2,new AnnotationLayerBuilder({pageDiv:r,pdfPage:t,linkService:l}).render(t.getViewport(1e3/t.getViewport({scale:1}).height),"display"),t.htmlContent=r,n(t)})},this.getCanvasByHeight=function(e,t,n){}},FLIPBOOK.PdfService.prototype={};var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}var EventBus=function(){function e(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).dispatchToDOM;_classCallCheck(this,e),this._listeners=Object.create(null),this._dispatchToDOM=!0===(void 0!==t&&t)}return _createClass(e,[{key:"on",value:function(e,t){var n=this._listeners[e];n||(n=[],this._listeners[e]=n),n.push(t)}},{key:"off",value:function(e,t){var n=this._listeners[e],i=void 0;!n||(i=n.indexOf(t))<0||n.splice(i,1)}},{key:"dispatch",value:function(e){var t=this._listeners[e];if(t&&0!==t.length){var n=Array.prototype.slice.call(arguments,1);t.slice(0).forEach(function(e){e.apply(null,n)}),this._dispatchToDOM&&this._dispatchDOMEvent(e,n)}else if(this._dispatchToDOM){var i=Array.prototype.slice.call(arguments,1);this._dispatchDOMEvent(e,i)}}},{key:"_dispatchDOMEvent",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(this._dispatchToDOM){var n=Object.create(null);if(t&&0<t.length){var i=t[0];for(var a in i){var r=i[a];if("source"!==a)n[a]=r;else if(r===window||r===document)return}}var s=document.createEvent("CustomEvent");s.initCustomEvent(e,!0,!0,n),document.dispatchEvent(s)}}},]),e}(),EXPAND_DIVS_TIMEOUT=300,MATCH_SCROLL_OFFSET_TOP=-50,MATCH_SCROLL_OFFSET_LEFT=-400,TextLayerBuilder=function(){function e(t){var n=t.textLayerDiv,i=t.eventBus,a=t.pageIndex,r=t.viewport,s=t.findController,o=t.enhanceTextSelection;_classCallCheck(this,e),this.textLayerDiv=n,this.eventBus=i||(0,_dom_events.getGlobalEventBus)(),this.textContent=null,this.textContentItemsStr=[],this.textContentStream=null,this.renderingDone=!1,this.pageIdx=a,this.pageNumber=this.pageIdx+1,this.matches=[],this.viewport=r,this.textDivs=[],this.findController=void 0===s?null:s,this.textLayerRenderTask=null,this.enhanceTextSelection=void 0!==o&&o,this._boundEvents=Object.create(null),this._bindEvents(),this._bindMouse()}return _createClass(e,[{key:"_finishRendering",value:function(){if(this.renderingDone=!0,!this.enhanceTextSelection){var e=document.createElement("div");e.className="endOfContent",this.textLayerDiv.appendChild(e)}this.eventBus.dispatch("textlayerrendered",{source:this,pageNumber:this.pageNumber,numTextDivs:this.textDivs.length})}},{key:"render",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;if((this.textContent||this.textContentStream)&&!this.renderingDone){this.cancel(),this.textDivs=[];var n=document.createDocumentFragment();this.textLayerRenderTask=(0,pdfjsLib.renderTextLayer)({textContent:this.textContent,textContentStream:this.textContentStream,container:n,viewport:this.viewport,textDivs:this.textDivs,textContentItemsStr:this.textContentItemsStr,timeout:t,enhanceTextSelection:this.enhanceTextSelection}),this.textLayerRenderTask.promise.then(function(){e.textLayerDiv.appendChild(n),e._finishRendering(),e.updateMatches()},function(e){})}}},{key:"cancel",value:function(){this.textLayerRenderTask&&(this.textLayerRenderTask.cancel(),this.textLayerRenderTask=null)}},{key:"setTextContentStream",value:function(e){this.cancel(),this.textContentStream=e}},{key:"setTextContent",value:function(e){this.cancel(),this.textContent=e}},{key:"convertMatches",value:function(e,t){var n=0,i=0,a=this.textContentItemsStr,r=a.length-1,s=null===this.findController?0:this.findController.state.query.length,o=[];if(!e)return o;for(var d=0,l=e.length;d<l;d++){for(var h=e[d];n!==r&&h>=i+a[n].length;)i+=a[n].length,n++;n===a.length&&console.error("Could not find a matching mapping");var c={begin:{divIdx:n,offset:h-i}};for(h+=t?t[d]:s;n!==r&&h>i+a[n].length;)i+=a[n].length,n++;c.end={divIdx:n,offset:h-i},o.push(c)}return o}},{key:"renderMatches",value:function(e){if(0!==e.length){var t=this.textContentItemsStr,n=this.textDivs,i=null,a=this.pageIdx,r=null!==this.findController&&a===this.findController.selected.pageIdx,s=null===this.findController?-1:this.findController.selected.matchIdx,o={divIdx:-1,offset:void 0},d=s,l=d+1;if(null!==this.findController&&this.findController.state.highlightAll)d=0,l=e.length;else if(!r)return;for(var h=d;h<l;h++){var c=e[h],g=c.begin,u=c.end,f=r&&h===s?" selected":"";if(this.findController&&this.findController.selected.matchIdx===h&&this.findController.selected.pageIdx===a){var v={top:MATCH_SCROLL_OFFSET_TOP,left:MATCH_SCROLL_OFFSET_LEFT};(0,_ui_utils.scrollIntoView)(n[g.divIdx],v,!0)}if(i&&g.divIdx===i.divIdx?$(i.divIdx,i.offset,g.offset):(null!==i&&$(i.divIdx,i.offset,o.offset),m(g)),g.divIdx===u.divIdx)$(g.divIdx,g.offset,u.offset,"highlight"+f);else{$(g.divIdx,g.offset,o.offset,"highlight begin"+f);for(var p=g.divIdx+1,x=u.divIdx;p<x;p++)n[p].className="highlight middle"+f;m(u,"highlight end"+f)}i=u}i&&$(i.divIdx,i.offset,o.offset)}function m(e,t){var i=e.divIdx;n[i].textContent="",$(i,0,e.offset,t)}function $(e,i,a,r){var s=n[e],o=t[e].substring(i,a),d=document.createTextNode(o);if(r){var l=document.createElement("span");return l.className=r,l.appendChild(d),void s.appendChild(l)}s.appendChild(d)}}},{key:"updateMatches",value:function(){if(this.renderingDone){for(var e=this.matches,t=this.textDivs,n=this.textContentItemsStr,i=-1,a=0,r=e.length;a<r;a++){for(var s=e[a],o=Math.max(i,s.begin.divIdx),d=s.end.divIdx;o<=d;o++){var l=t[o];l.textContent=n[o],l.className=""}i=s.end.divIdx+1}if(this.findController&&this.findController.highlightMatches){var h=void 0,c=void 0;null!==this.findController&&(h=this.findController.pageMatches[this.pageIdx]||null,c=this.findController.pageMatchesLength&&this.findController.pageMatchesLength[this.pageIdx]||null),this.matches=this.convertMatches(h,c),this.renderMatches(this.matches)}}}},{key:"_bindEvents",value:function(){var e=this,t=this.eventBus,n=this._boundEvents;n.pageCancelled=function(i){if(i.pageNumber===e.pageNumber){if(e.textLayerRenderTask)console.error("TextLayerBuilder._bindEvents: `this.cancel()` should have been called when the page was reset, or rendering cancelled.");else for(var a in n)t.off(a.toLowerCase(),n[a]),delete n[a]}},n.updateTextLayerMatches=function(t){t.pageIndex!==e.pageIdx&&-1!==t.pageIndex||e.updateMatches()},t.on("pagecancelled",n.pageCancelled),t.on("updatetextlayermatches",n.updateTextLayerMatches)}},{key:"_bindMouse",value:function(){var e=this,t=this.textLayerDiv,n=null;t.addEventListener("mousedown",function(i){if(e.enhanceTextSelection&&e.textLayerRenderTask)return e.textLayerRenderTask.expandTextDivs(!0),void(n&&(clearTimeout(n),n=null));var a=t.querySelector(".endOfContent");if(a){var r=i.target!==t;if(r=r&&"none"!==window.getComputedStyle(a).getPropertyValue("-moz-user-select")){var s=t.getBoundingClientRect(),o=Math.max(0,(i.pageY-s.top)/s.height);a.style.top=(100*o).toFixed(2)+"%"}a.classList.add("active")}}),t.addEventListener("mouseup",function(){if(e.enhanceTextSelection&&e.textLayerRenderTask)n=setTimeout(function(){e.textLayerRenderTask&&e.textLayerRenderTask.expandTextDivs(!1),n=null},EXPAND_DIVS_TIMEOUT);else{var i=t.querySelector(".endOfContent");i&&(i.style.top="",i.classList.remove("active"))}})}},]),e}(),DefaultTextLayerFactory=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"createTextLayerBuilder",value:function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]&&arguments[3];return new TextLayerBuilder({textLayerDiv:e,pageIndex:t,viewport:n,enhanceTextSelection:i})}},]),e}(),PDFLinkService=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=t.eventBus,i=t.externalLinkTarget,a=t.externalLinkRel;_classCallCheck(this,e),this.eventBus=n||(0,_dom_events.getGlobalEventBus)(),this.externalLinkTarget=void 0===i?null:i,this.externalLinkRel=void 0===a?null:a,this.baseUrl=null,this.pdfDocument=null,this.pdfViewer=null,this.pdfHistory=null,this._pagesRefCache=null}return _createClass(e,[{key:"setDocument",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.baseUrl=t,this.pdfDocument=e,this._pagesRefCache=Object.create(null)}},{key:"setViewer",value:function(e){this.pdfViewer=e}},{key:"setHistory",value:function(e){this.pdfHistory=e}},{key:"navigateTo",value:function(e){var t=this;new Promise(function(n,i){"string"!=typeof e?n({namedDest:"",explicitDest:e}):t.pdfDocument.getDestination(e).then(function(t){n({namedDest:e,explicitDest:t})})}).then(function(n){Array.isArray(n.explicitDest)?function n(i){var a=i.namedDest,r=i.explicitDest,s=r[0],o=void 0;if(s instanceof Object){if(null===(o=t._cachedPageNumber(s)))return void t.pdfDocument.getPageIndex(s).then(function(e){t.cachePageRef(e+1,s),n({namedDest:a,explicitDest:r})}).catch(function(){console.error('PDFLinkService.navigateTo: "'+s+'" is not a valid page reference, for dest="'+e+'".')})}else{if(!Number.isInteger(s))return void console.error('PDFLinkService.navigateTo: "'+s+'" is not a valid destination reference, for dest="'+e+'".');o=s+1}!o||o<1||o>t.pagesCount?console.error('PDFLinkService.navigateTo: "'+o+'" is not a valid page number, for dest="'+e+'".'):(t.pdfHistory&&(t.pdfHistory.pushCurrentPosition(),t.pdfHistory.push({namedDest:a,explicitDest:r,pageNumber:o})),t.pdfViewer.scrollPageIntoView({pageNumber:o,destArray:r}))}(n):console.error('PDFLinkService.navigateTo: "'+n.explicitDest+'" is not a valid destination array, for dest="'+e+'".')})}},{key:"getDestinationHash",value:function(e){if("string"==typeof e)return this.getAnchorUrl("#"+escape(e));if(Array.isArray(e)){var t=JSON.stringify(e);return this.getAnchorUrl("#"+escape(t))}return this.getAnchorUrl("")}},{key:"getAnchorUrl",value:function(e){return(this.baseUrl||"")+e}},{key:"setHash",value:function(e){var t=void 0,n=void 0;if(e.includes("=")){var i=(0,_ui_utils.parseQueryString)(e);if("search"in i&&this.eventBus.dispatch("findfromurlhash",{source:this,query:i.search.replace(/"/g,""),phraseSearch:"true"===i.phrase}),"nameddest"in i)return void this.navigateTo(i.nameddest);if("page"in i&&(t=0|i.page||1),"zoom"in i){var a=i.zoom.split(","),r=a[0],s=parseFloat(r);r.includes("Fit")?"Fit"===r||"FitB"===r?n=[null,{name:r}]:"FitH"===r||"FitBH"===r||"FitV"===r||"FitBV"===r?n=[null,{name:r},1<a.length?0|a[1]:null]:"FitR"===r?5!==a.length?console.error('PDFLinkService.setHash: Not enough parameters for "FitR".'):n=[null,{name:r},0|a[1],0|a[2],0|a[3],0|a[4]]:console.error('PDFLinkService.setHash: "'+r+'" is not a valid zoom value.'):n=[null,{name:"XYZ"},1<a.length?0|a[1]:null,2<a.length?0|a[2]:null,s?s/100:r]}n?this.pdfViewer.scrollPageIntoView({pageNumber:t||this.page,destArray:n,allowNegativeOffset:!0}):t&&(this.page=t),"pagemode"in i&&this.eventBus.dispatch("pagemode",{source:this,mode:i.pagemode})}else{n=unescape(e);try{n=JSON.parse(n),Array.isArray(n)||(n=n.toString())}catch(o){}if("string"==typeof n||isValidExplicitDestination(n))return void this.navigateTo(n);console.error('PDFLinkService.setHash: "'+unescape(e)+'" is not a valid destination.')}}},{key:"executeNamedAction",value:function(e){switch(e){case"GoBack":this.pdfHistory&&this.pdfHistory.back();break;case"GoForward":this.pdfHistory&&this.pdfHistory.forward();break;case"NextPage":this.page<this.pagesCount&&this.page++;break;case"PrevPage":1<this.page&&this.page--;break;case"LastPage":this.page=this.pagesCount;break;case"FirstPage":this.page=1}this.eventBus.dispatch("namedaction",{source:this,action:e})}},{key:"cachePageRef",value:function(e,t){if(t){var n=t.num+" "+t.gen+" R";this._pagesRefCache[n]=e}}},{key:"_cachedPageNumber",value:function(e){var t=e.num+" "+e.gen+" R";return this._pagesRefCache&&this._pagesRefCache[t]||null}},{key:"pagesCount",get:function(){return this.pdfDocument?this.pdfDocument.numPages:0}},{key:"page",get:function(){return this.pdfViewer.currentPageNumber},set:function(e){this.pdfViewer.currentPageNumber=e}},{key:"rotation",get:function(){return this.pdfViewer.pagesRotation},set:function(e){this.pdfViewer.pagesRotation=e}},]),e}();function isValidExplicitDestination(e){if(!Array.isArray(e))return!1;var t=e.length,n=!0;if(t<2)return!1;var i=e[0];if(!("object"===(void 0===i?"undefined":_typeof(i))&&Number.isInteger(i.num)&&Number.isInteger(i.gen)||Number.isInteger(i)&&0<=i))return!1;var a=e[1];if("object"!==(void 0===a?"undefined":_typeof(a))||"string"!=typeof a.name)return!1;switch(a.name){case"XYZ":if(5!==t)return!1;break;case"Fit":case"FitB":return 2===t;case"FitH":case"FitBH":case"FitV":case"FitBV":if(3!==t)return!1;break;case"FitR":if(6!==t)return!1;n=!1;break;default:return!1}for(var r=2;r<t;r++){var s=e[r];if(!("number"==typeof s||n&&null===s))return!1}return!0}var SimpleLinkService=function(){function e(){_classCallCheck(this,e),this.externalLinkTarget=null,this.externalLinkRel=null}return _createClass(e,[{key:"navigateTo",value:function(e){}},{key:"getDestinationHash",value:function(e){return"#"}},{key:"getAnchorUrl",value:function(e){return"#"}},{key:"setHash",value:function(e){}},{key:"executeNamedAction",value:function(e){}},{key:"cachePageRef",value:function(e,t){}},{key:"pagesCount",get:function(){return 0}},{key:"page",get:function(){return 0},set:function(e){}},{key:"rotation",get:function(){return 0},set:function(e){}},]),e}(),AnnotationLayerBuilder=function(){function e(t){var n=t.pageDiv,i=t.pdfPage,a=t.linkService,r=t.downloadManager,s=t.imageResourcesPath,o=t.renderInteractiveForms;_classCallCheck(this,e),this.pageDiv=n,this.pdfPage=i,this.linkService=a,this.downloadManager=r,this.imageResourcesPath=void 0===s?"":s,this.renderInteractiveForms=void 0!==o&&o,this.div=null,this._cancelled=!1}return _createClass(e,[{key:"render",value:function(e){var t=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"display";this.pdfPage.getAnnotations({intent:n}).then(function(n){if(!t._cancelled){var i={viewport:e.clone({dontFlip:!0}),div:t.div,annotations:n,page:t.pdfPage,imageResourcesPath:t.imageResourcesPath,renderInteractiveForms:t.renderInteractiveForms,linkService:t.linkService,downloadManager:t.downloadManager};if(t.div)pdfjsLib.AnnotationLayer.update(i);else{if(0===n.length)return;t.div=document.createElement("div"),t.div.className="annotationLayer",t.pageDiv.appendChild(t.div),i.div=t.div,pdfjsLib.AnnotationLayer.render(i)}}})}},{key:"cancel",value:function(){this._cancelled=!0}},{key:"hide",value:function(){this.div&&this.div.setAttribute("hidden","true")}},]),e}(),DefaultAnnotationLayerFactory=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"createAnnotationLayerBuilder",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",i=3<arguments.length&&void 0!==arguments[3]&&arguments[3];return new AnnotationLayerBuilder({pageDiv:e,pdfPage:t,imageResourcesPath:n,renderInteractiveForms:i,linkService:new SimpleLinkService})}},]),e}(),TEXT_LAYER_RENDER_DELAY=200,MAX_TEXT_DIVS_TO_RENDER=1e5,NonWhitespaceRegexp=/\S/;